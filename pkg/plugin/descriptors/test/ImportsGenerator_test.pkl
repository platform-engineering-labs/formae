/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

/// These tests verify the output format and logic of the ImportsGenerator.
/// Since we can't easily mock the PklProject import, we test the output
/// structure and verify it matches expected patterns.
module formae.plugin.test.ImportsGeneratorTest

amends "pkl:test"

import "../ImportsGenerator.pkl"

facts {
    ["output starts with header comments"] {
        local output = ImportsGenerator.output.text
        output.startsWith("// Generated by ImportsGenerator.pkl")
        output.contains("// Do not edit manually")
    }

    ["output contains packages Mapping declaration"] {
        local output = ImportsGenerator.output.text
        output.contains("packages: Mapping<String, Mapping<String, Module>> = new Mapping {")
    }

    ["output ends with closing brace"] {
        local output = ImportsGenerator.output.text
        output.endsWith("}")
    }

    ["formae is excluded from imports (not a resource provider)"] {
        local output = ImportsGenerator.output.text
        // formae should NOT appear as an import since it's a core library
        !output.contains("[\"@formae\"]")
        !output.contains("import*(\"@formae/")
    }

    ["schema packages use @name prefix"] {
        local output = ImportsGenerator.output.text
        // Any package imports should use @ prefix
        // This regex-like check ensures proper format
        output.contains("packages: Mapping<String, Mapping<String, Module>>")
    }
}

examples {
    ["generated imports.pkl content"] {
        ImportsGenerator.output.text
    }
}
