/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

module aws.lambda.version

import "@formae/formae.pkl"
import "../aws.pkl"

const type = "AWS::Lambda::Version"

@aws.SubResourceHint
open class ProvisionedConcurrencyConfiguration extends formae.SubResource {
    provisionedConcurrentExecutions: Int
}

@aws.SubResourceHint
open class RuntimePolicy extends formae.SubResource {
    runtimeVersionArn: (String(matches(Regex(#"^arn:(aws[a-zA-Z-]*):lambda:[a-z]{2}((-gov)|(-iso([a-z]?)))?-[a-z]+-\d{1}::runtime:.+$"#)))|formae.Resolvable)?
    updateRuntimeOn: String
}

@aws.ResourceHint {
    type = module.type
    identifier = "Version"
    parent = "AWS::Lambda::Function"
    listParam = new formae.ListProperty { parentProperty = "FunctionName" listParameter = "FunctionName" }
}
open class Version extends formae.Resource {

    @aws.FieldHint{createOnly = true}
    codeSha256: String?

    @aws.FieldHint{createOnly = true}
    description: String?

    @aws.FieldHint{createOnly = true}
    functionName: String(matches(Regex(#"^(arn:(aws[a-zA-Z-]*)?:lambda:)?([a-z]{2}((-gov)|(-iso([a-z]?)))?-[a-z]+-\d{1}:)?(\d{12}:)?(function:)?([a-zA-Z0-9-_]+)(:(\$LATEST|[a-zA-Z0-9-_]+))?$"#)))|formae.Resolvable

    @aws.FieldHint{createOnly = true}
    provisionedConcurrencyConfig: ProvisionedConcurrencyConfiguration?

    @aws.FieldHint
    runtimePolicy: RuntimePolicy?
}