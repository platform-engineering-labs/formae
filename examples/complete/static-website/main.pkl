/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

amends "@formae/forma.pkl"
import "@formae/formae.pkl"

import "@aws/aws.pkl"

import "./vars.pkl"
import "./components/s3_website.pkl" as storage
import "./components/cloudfront.pkl" as cdn
import "./components/dns.pkl"

properties {
    // Project configuration
    projectName = new formae.Prop {
        flag = "project-name"
        default = vars.projectName
    }
    environment = new formae.Prop {
        flag = "env"
        default = vars.environment
    }

    // Infrastructure configuration
    region = new formae.Prop {
        flag = "region"
        default = vars.region
    }
    bucketSuffix = new formae.Prop {
        flag = "bucket-suffix"
        default = vars.bucketSuffix
    }
    domainName = new formae.Prop {
        flag = "domain"
        default = vars.domainName
    }
}

forma {
    new formae.Stack {
        label = vars.stackName
        description = "Stack for static website hosting"
    }

    new formae.Target {
        label = "aws-target"
        config = new aws.Config {
            region = properties.region.value
        }
    }

    // Storage layer (S3)
    storage.siteBucket
    storage.siteBucketPolicy

    // Content delivery (CloudFront)
    cdn.cfdistribution

    // DNS
    dns.zone
    dns.alias
}